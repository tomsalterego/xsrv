[Interface]
Address = {{ wireguard_server_ip }}
PrivateKey = {{ wireguard_server_private_key.content | b64decode }}
ListenPort = 51820

{% for peer in wireguard_peers %}
{% if peer.state is not defined or peer.state == "present" %}
{% if peer.public_key is not defined %}
# Peer: {{ peer.name }}
PostUp = wg set %i peer <(cat /etc/wireguard/peers/{{ peer.name }}.pub ) allowed-ips {{ peer.ip_address }}

{% else %}
[Peer]
# Peer: {{ peer.name }}
PublicKey = {{ peer.public_key }}
AllowedIPs = {{ peer.ip_address }}

{% endif%}
{% endif %}
{% endfor %}
